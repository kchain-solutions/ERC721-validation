<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1086px" preserveAspectRatio="none" style="width:1432px;height:1086px;background:#FFFFFF;" version="1.1" viewBox="0 0 1432 1086" width="1432px" zoomAndPan="magnify"><defs><filter height="300%" id="f17fdpn5k46r6z" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1074.5781" style="stroke:#A80036;stroke-width:1.0;" width="464" x="665.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="868" y="18.0669">Onchain</text><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="206.8281"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="265.0938"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="129.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="352.4922"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="433.9922" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="535.2891"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="480.2578" style="stroke:#000000;stroke-width:2.0;" width="1408.5" x="10" y="497.0234"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="749" x="659.5" y="637.6875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="39" x2="39" y1="88.2969" y2="994.2813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="273" x2="273" y1="88.2969" y2="994.2813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="759.5" x2="759.5" y1="88.2969" y2="994.2813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="926.5" x2="926.5" y1="88.2969" y2="994.2813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1102.5" x2="1102.5" y1="88.2969" y2="994.2813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1352.5" x2="1352.5" y1="88.2969" y2="994.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="20" y="84.9951">User</text><ellipse cx="39" cy="15" fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M39,23 L39,50 M26,31 L52,31 M39,50 L26,65 M39,50 L52,65 " fill="none" filter="url(#f17fdpn5k46r6z)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="20" y="1006.2764">User</text><ellipse cx="39" cy="1019.5781" fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M39,1027.5781 L39,1054.5781 M26,1035.5781 L52,1035.5781 M39,1054.5781 L26,1069.5781 M39,1054.5781 L52,1069.5781 " fill="none" filter="url(#f17fdpn5k46r6z)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="76" x="233" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="240" y="72.9951">Web App</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="76" x="233" y="993.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="240" y="1013.2764">Web App</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="177" x="669.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163" x="676.5" y="72.9951">Validator smart contract</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="177" x="669.5" y="993.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163" x="676.5" y="1013.2764">Validator smart contract</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="129" x="860.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="867.5" y="72.9951">NFT Marketplace</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="129" x="860.5" y="993.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="867.5" y="1013.2764">NFT Marketplace</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="41" x="1080.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="1087.5" y="72.9951">NFT</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="41" x="1080.5" y="993.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="1087.5" y="1013.2764">NFT</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="87" x="1307.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="1314.5" y="72.9951">The Graph</text><rect fill="#FEFECE" filter="url(#f17fdpn5k46r6z)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="87" x="1307.5" y="993.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="1314.5" y="1013.2764">The Graph</text><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="206.8281"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="265.0938"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="129.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="352.4922"/><rect fill="#FFFFFF" filter="url(#f17fdpn5k46r6z)" height="433.9922" style="stroke:#A80036;stroke-width:1.0;" width="10" x="268" y="535.2891"/><polygon fill="#A80036" points="915,115.4297,925,119.4297,915,123.4297,919,119.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39" x2="921" y1="119.4297" y2="119.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="46" y="114.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="59" y="114.3638">Buying NFT</text><polygon fill="#A80036" points="1091,144.5625,1101,148.5625,1091,152.5625,1095,148.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="927" x2="1097" y1="148.5625" y2="148.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="934" y="143.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="947" y="143.4966">Transfering ownership</text><polygon fill="#A80036" points="50,173.6953,40,177.6953,50,181.6953,46,177.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="44" x2="1102" y1="177.6953" y2="177.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="56" y="172.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="73" y="172.6294"/><polygon fill="#A80036" points="748,202.8281,758,206.8281,748,210.8281,752,206.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="754" y1="206.8281" y2="206.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="285" y="201.7622">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="298" y="201.7622">Instantiating a validator</text><polygon fill="#A80036" points="284,231.9609,274,235.9609,284,239.9609,280,235.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="278" x2="759" y1="235.9609" y2="235.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="290" y="230.895">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="303" y="230.895">Ok</text><polygon fill="#A80036" points="748,261.0938,758,265.0938,748,269.0938,752,265.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="754" y1="265.0938" y2="265.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="285" y="260.0278">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="298" y="260.0278">Registering a NFT address calling</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="86" x="512" y="260.0278">registerNFT</text><polygon fill="#A80036" points="1091,290.2266,1101,294.2266,1091,298.2266,1095,294.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="760" x2="1097" y1="294.2266" y2="294.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="767" y="289.1606">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="784" y="289.1606"/><polygon fill="#A80036" points="284,319.3594,274,323.3594,284,327.3594,280,323.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="278" x2="759" y1="323.3594" y2="323.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="290" y="318.2935">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="303" y="318.2935">Ok</text><polygon fill="#A80036" points="256,348.4922,266,352.4922,256,356.4922,260,352.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39" x2="262" y1="352.4922" y2="352.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="46" y="347.4263">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="59" y="347.4263">Setting a secretKey</text><polygon fill="#A80036" points="748,377.625,758,381.625,748,385.625,752,381.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="754" y1="381.625" y2="381.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="285" y="376.5591">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="307" y="376.5591">Call</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="334" y="376.5591">setSecret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="408" y="376.5591">method</text><polygon fill="#A80036" points="289,406.7578,279,410.7578,289,414.7578,285,410.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="283" x2="759" y1="410.7578" y2="410.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="295" y="405.6919">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="317" y="405.6919">Ok</text><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="320" y1="439.8906" y2="439.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="320" x2="320" y1="439.8906" y2="452.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279" x2="320" y1="452.8906" y2="452.8906"/><polygon fill="#A80036" points="289,448.8906,279,452.8906,289,456.8906,285,452.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="285" y="434.8247">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="307" y="434.8247">(*)OPT: saving secretKey</text><polygon fill="#A80036" points="50,478.0234,40,482.0234,50,486.0234,46,482.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="44" x2="272" y1="482.0234" y2="482.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="56" y="476.9575">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="78" y="476.9575">Ok</text><path d="M10,497.0234 L120,497.0234 L120,504.0234 L110,514.0234 L10,514.0234 L10,497.0234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="480.2578" style="stroke:#000000;stroke-width:2.0;" width="1408.5" x="10" y="497.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="25" y="510.0903">Payment</text><polygon fill="#A80036" points="256,531.2891,266,535.2891,256,539.2891,260,535.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39" x2="262" y1="535.2891" y2="535.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46" y="530.2231">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="68" y="530.2231">Payment with NFT discount</text><polygon fill="#A80036" points="748,560.4219,758,564.4219,748,568.4219,752,564.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="754" y1="564.4219" y2="564.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="285" y="559.356">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="307" y="559.356">Call</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="334" y="559.356">validate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="397" y="559.356">method with an</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="500" y="559.356">userSessionId</text><polygon fill="#A80036" points="1091,589.5547,1101,593.5547,1091,597.5547,1095,593.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="760" x2="1097" y1="593.5547" y2="593.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="767" y="588.4888">16</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="75" x="789" y="588.4888">balanceOf</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="868" y="588.4888">for the user address</text><polygon fill="#A80036" points="771,618.6875,761,622.6875,771,626.6875,767,622.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="765" x2="1102" y1="622.6875" y2="622.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="777" y="617.6216">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="803" y="617.6216"/><path d="M659.5,637.6875 L815.5,637.6875 L815.5,644.6875 L805.5,654.6875 L659.5,654.6875 L659.5,637.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="749" x="659.5" y="637.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="674.5" y="650.7544">balanceOf &gt;=1</text><polygon fill="#A80036" points="1341,671.9531,1351,675.9531,1341,679.9531,1345,675.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="760" x2="1347" y1="675.9531" y2="675.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="767" y="670.8872">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="789" y="670.8872">Emitting</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="846" y="670.8872">validation event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="968" y="670.8872">(validatorId, nftAddr, userAddr,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="1168" y="670.8872">verificationHash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="1287" y="670.8872">, result)</text><polygon fill="#A80036" points="289,708.0859,279,712.0859,289,716.0859,285,712.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="283" x2="759" y1="712.0859" y2="712.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="295" y="707.02">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="317" y="707.02">Ok</text><polygon fill="#A80036" points="1341,737.2188,1351,741.2188,1341,745.2188,1345,741.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="1347" y1="741.2188" y2="741.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="285" y="736.1528">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="307" y="736.1528">Querying events</text><polygon fill="#A80036" points="289,766.3516,279,770.3516,289,774.3516,285,770.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="283" x2="1352" y1="770.3516" y2="770.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="295" y="765.2856">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="317" y="765.2856">Events with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="393" y="765.2856">verificationHash</text><polygon fill="#A80036" points="256,808.0508,266,812.0508,256,816.0508,260,812.0508" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39" x2="262" y1="812.0508" y2="812.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46" y="806.9849">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="68" y="806.9849">(*)OPT: Insert secretKey</text><path d="M283,783.3516 L283,823.3516 L1028,823.3516 L1028,793.3516 L1018,783.3516 L283,783.3516 " fill="#FBFB77" filter="url(#f17fdpn5k46r6z)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1018,783.3516 L1018,793.3516 L1028,793.3516 L1018,783.3516 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="498" x="289" y="800.4185">(*)To improve security, the user should prove the knowledge of his secret Key.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="724" x="289" y="815.5513">On the other hand, to enhance the user experience, the secret key can either be omitted or saved in the session.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="278" x2="320" y1="868.8828" y2="868.8828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="320" x2="320" y1="868.8828" y2="881.8828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279" x2="320" y1="881.8828" y2="881.8828"/><polygon fill="#A80036" points="289,877.8828,279,881.8828,289,885.8828,285,881.8828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="285" y="856.2505">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="307" y="848.6841">Checking if there is a new Event that match</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="307" y="863.8169">verificationHash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="430" y="863.8169">==</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="292" x="456" y="863.8169">HASH(UserSessionId, HASH(secretKey))</text><polygon fill="#A80036" points="50,907.0156,40,911.0156,50,915.0156,46,911.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="44" x2="267" y1="911.0156" y2="911.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="56" y="905.9497">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="78" y="905.9497">Authorizing user for discount</text><polygon fill="#A80036" points="256,936.1484,266,940.1484,256,944.1484,260,940.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39" x2="262" y1="940.1484" y2="940.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46" y="935.0825">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="68" y="935.0825">Confirm payments</text><polygon fill="#A80036" points="50,965.2813,40,969.2813,50,973.2813,46,969.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="44" x2="272" y1="969.2813" y2="969.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="56" y="964.2153">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="78" y="964.2153">Ok</text><!--MD5=[c15f7a9b5d4b4a41581c96609572cf6d]
@startuml
autonumber
actor user as "User"
participant client as "Web App"
box "Onchain"
	participant validator as "Validator smart contract"
	participant nftm as "NFT Marketplace"
	participant nft as "NFT"
end box 
participant graph as "The Graph"

user -> nftm: Buying NFT
nftm -> nft: Transfering ownership
nft - -> user

client -> validator: Instantiating a validator
activate client
validator - -> client: Ok
deactivate client
client -> validator: Registering a NFT address calling **registerNFT**
activate client
validator - -> nft
validator - -> client: Ok
deactivate client

user -> client: Setting a secretKey
activate client
client -> validator: Call **setSecret** method
validator - -> client: Ok 
client -> client: (*)OPT: saving secretKey
client - -> user: Ok
deactivate client
group Payment
		user -> client: Payment with NFT discount  
	activate client
		client -> validator: Call **validate** method with an **userSessionId**
		validator -> nft: **balanceOf** for the user address 
		nft - -> validator

		group balanceOf >=1
			validator - -> graph: Emitting **validation event** (validatorId, nftAddr, userAddr, **verificationHash**, result)
		end group
		validator - -> client: Ok

		client -> graph: Querying events
		graph - -> client: Events with **verificationHash**
		user -> client: (*)OPT: Insert secretKey
		note right: (*)To improve security, the user should prove the knowledge of his secret Key.\nOn the other hand, to enhance the user experience, the secret key can either be omitted or saved in the session.
		client -> client: Checking if there is a new Event that match\n**verificationHash** == **HASH(UserSessionId, HASH(secretKey))**
		client  - -> user: Authorizing user for discount
		user -> client: Confirm payments
		client - -> user: Ok
	deactivate client
end group
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>